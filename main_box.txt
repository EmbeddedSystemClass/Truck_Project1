Main Box to house STM32 chip and keypad 

Screen Box has the AVR & LCD screen (in sep. panel to left above red & green buttons)

This box replaces the old monster box which housed the screen, keypad, AVR, PIC24FJ and the FPGA boards.
The main box connects to the screen box via an RS-232 cable using 3v3->5v & RS-232 converters
There is also a PWM wire from the STM32 to the screen box (or use the PWM on from the FPGA)

The AVR and screen work as before and are connected the same, but an STM32 Discovery board replaces the
Microchip PIC24FJ.

The FPGA board will be in another box and will communicate with the Main Box via a serial port and the
same handshacking lines as before. (UART3)

serial ports:

UART1: monitor/TS-7200 (external)
UART2: AVR (external)
UART3: FPGA (external with 2 handshaking lines)

The STM32 has up to 16 ADC channels but the FPGA can be used to do the ADC using support chips.
The FPGA drove the 2 speakers for tones but the STM32 could do this. (keypad tones and alarms)

pinout for LCD:

21) LEDK	| gnd for LCD backlight (not on pinout - wired separately)
20) LEDA	| +5v for  "     "			"				"
19) VEE		goes to gnd threw 20K pot with center tap to VO	
18) FS		font select
17) DATA 7	data lines
16) DATA 6
15) DATA 5
14) DATA 4
13) DATA 3
12) DATA 2
11) DATA 1
10) DATA 0
9) RST		reset signal
8) C/D		command/data
7) CE		chip enable
6) RD		read
5) WR		write
4) VO		goes to center tap of 20k pot
3) VDD		signal +5v
2) VSS		signal gnd
1) FG		frame ground (can go to pin 2)

bottom view w/ reset button on right

TX		RX		RESET*		gnd		PD2		PD3		PD4		PD5		PD6		PD7		PB0		PB1

RAW		gnd		RESET*		VCC		PC3		PC2		PC1		PC0		PB5		PB4		PB3		PB2
																	SCLK	MISO	MOSI	SS
*either one goes to CS signal on programmer

1)  gnd
2)  +5V
3)  VPU
4)  CLK
5)  CS
 6)  3.3V
7)  ADC
8)  AUX
9)  MOSI
10) MISO
(all I'm using, currently are 1,4,5,9 & 10)

ICD cable from programmer looking at hole side with cable up:

1	2	3	4	5
6	7	8	9	10


AVR to t6963:
WR		C0
CE		C1
RST		C2
CD		C3
RD		C4*
DATA0	D2
DATA1	D3
DATA2	D4
DATA3	D5
DATA4	D6
DATA5	D7
DATA6	B0
DATA7	B1

* this one is hidden behind PC3 & PC2 labeled as A2 & A3 on some chips
or labeled as A4 behind reset button on non-pinout end

use an IFR630N mosfet to dim the screen using a PWM signal:
(looking at top of IFR630N)
gate drain source
gate - 3v3 or 5v signal
drain - comes from gnd of LCD backlight (+LCD backlight is +5v always)
source - goes to gnd
for now use a toggle switch as signal (on/off)
in the future, use a pwm signal from either FPGA or STM32

keypad:

columns:	GPIOC

col0 GPIO_0
col1 GPIO_1
col2 GPIO_2
col3 GPIO_3

rows:		GPIOB

row3 GPIO_12
row2 GPIO_13
row1 GPIO_14
row0 GPIO_15

Usr1_GPIO_Port GPIOA  GPIO_0

external connectors for Main Box:

UART1: standard DB-9
RX PA10 - goes to RX on DB-9 converter
TX PA9  - goes to TX on DB-9 converter

UART2: standard DB-9

UART3: 5-pin connector

LED indicator lights:
1) engine on
2) fan on
3) blinks blue/green on start-up

LED3 - green
LED4 - blue

USART1 - 	PA9 TX		printHexByte1()	- 7200
			PA10 RX
			
USART2 -	PA2 TX		printHexByte2()	- AVR (LCD)
			PA3 RX
			
USART3 -	PB10 TX
			PB11 RX
			
DS1620 pins: (PORTB)

DS1620_PIN_DQ	GPIO_PIN_0
DS1620_PIN_CLK	GPIO_PIN_1
DS1620_PIN_RST	GPIO_PIN_2

PA1 - ADC channel 1

keypad:

col0		PC0
col1		PC1
col2		PC2
col3		PC3

row0		PB15
row1		PB14
row2		PB13
row3		PB12

StartAVRTask() waits for a SendAVRQueueHandle message.
Any task sending a SendAVRQueueHandle message will
pack an 8-bit UCHAR array into a uint64_t which is
send to the queue handle. Use pack64() to byte shift
the UCHAR array into the uint64_t. The first byte of
the UCHAR array is the command which ends up in the
lowest significant byte of the uint64_t.

seperate processor to handle the windshield wiper motor:

bk - common
rd - park switch
wt - low speed
bl - high speed
read ohms between bk & rd - when open, wipers are in park position
when closed they are up, either going up or down

monitor input for off/intermitent/low/high
processor monitors the park input (closed when wipers reach park position)
use AVR pro-mini to control wipers

FPGA: (signals needed so far - some may need to be converted to 5v)

# serial port
tx_uart P34
rx_uart P36

# inputs from sensors
rpm_signal P77
mph_signal P75

# 7-seg LED outputs
tx_rpm P69
tx_mph P64

# speaker outputs
pwm_spk1 P62
pwm_spk2 P61

# pwm for dimmer for LCD screen
pwm_lcd P60
fp_shutoff P33
rev_limit P82

#SPI master signals
#MOSI_o P48
#MISO_i P45
#SCLK_o P41
#SS_o P39

data_ready P24
cmd_param P30
data_sent P28
rx_ds1620 P40
ref_signal P42


